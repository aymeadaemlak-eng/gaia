<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Değer Kaybı Otomasyonu</title>
  <script>
    // === KONFIGURASYON (en üst) ===
    // Evraklar yüklendi ise true yapın. False ise ilk aşamadaki açıklama görünür.
    if (typeof window.EVRAKLAR_YUKLENDI === "undefined") {
      window.EVRAKLAR_YUKLENDI = false;
    }

    if (typeof window.RESULT_DATA_JSON === "undefined") {
      window.RESULT_DATA_JSON = "";
    }
  </script>
  <style>
    :root {
      color-scheme: light;
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
      --bg: #f7f8fb;
      --card: #ffffff;
      --text: #1d2433;
      --muted: #5f6b7a;
      --primary: #1f6feb;
      --primary-dark: #164fc5;
      --border: #e4e8f0;
      --success: #0a7b42;
      --warning: #f59e0b;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, #ffffff 0%, #f7f8fb 45%, #eef2f7 100%);
      color: var(--text);
    }

    #app {
      min-height: 100vh;
      padding: 20px;
    }

    .layout {
      display: grid;
      gap: 24px;
    }

    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
      border: 1px solid var(--border);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 36px rgba(15, 23, 42, 0.12);
    }

    h1, h2, h3, h4 {
      margin: 0 0 12px;
    }

    p {
      margin: 0 0 12px;
      color: var(--muted);
      line-height: 1.5;
    }

    .stack {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .grid {
      display: grid;
      gap: 20px;
    }

    .main-panel {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .hero {
      display: grid;
      gap: 16px;
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .hero-card {
      padding: 28px;
      border-radius: 20px;
      background: linear-gradient(135deg, #ffffff 15%, #eef4ff 65%, #f7fbff 100%);
      border: 1px solid #dbe4f5;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.08);
    }

    .summary-card {
      display: grid;
      gap: 16px;
      padding: 20px;
      border-radius: 18px;
      border: 1px solid #d9e2f4;
      background: linear-gradient(135deg, #ffffff 0%, #f5f8ff 100%);
      box-shadow: 0 18px 36px rgba(15, 23, 42, 0.08);
    }

    .summary-header {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
    }

    .summary-amount {
      font-size: 28px;
      font-weight: 700;
      color: var(--primary-dark);
    }

    .summary-meta {
      font-size: 14px;
      color: var(--muted);
    }

    .summary-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .summary-actions .outline-button,
    .summary-actions .primary {
      min-width: 180px;
    }

    .hero-top {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .hero-title {
      font-size: 28px;
      line-height: 1.2;
      margin-bottom: 8px;
    }

    .hero-actions-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      color: var(--primary);
      text-decoration: none;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(31, 111, 235, 0.12);
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .hero-actions-link:hover {
      text-decoration: underline;
      background: rgba(31, 111, 235, 0.2);
      transform: translateY(-1px);
    }

    .secure-note {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: #eef7f2;
      color: #0a5f38;
      font-size: 13px;
      font-weight: 600;
    }

    .secure-meta {
      display: block;
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 500;
    }

    .badge {
      display: inline-flex;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(31, 111, 235, 0.1);
      color: var(--primary);
      font-weight: 600;
      font-size: 12px;
      letter-spacing: 0.3px;
      text-transform: uppercase;
    }

    .toast {
      display: none;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 14px 18px;
      border-radius: 12px;
      border: 1px solid transparent;
      font-weight: 600;
      font-size: 14px;
    }

    .toast-success {
      background: #ecfdf3;
      border-color: #bbf7d0;
      color: #166534;
    }

    .toast-error {
      background: #fef2f2;
      border-color: #fecaca;
      color: #991b1b;
    }

    .progress {
      display: grid;
      gap: 12px;
    }

    .progress-step {
      display: flex;
      gap: 12px;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fdfdff;
      align-items: center;
    }

    .progress-step span {
      font-weight: 700;
      color: var(--primary);
      background: rgba(31, 111, 235, 0.1);
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    label {
      font-weight: 600;
      font-size: 14px;
    }

    input[type="file"] {
      padding: 16px;
      border: 2px dashed #cfd8e6;
      border-radius: 14px;
      background: #f9fafc;
    }

    button {
      border: none;
      padding: 14px 18px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      background: var(--primary);
      color: #fff;
      transition: background 0.2s ease;
    }

    button:hover {
      background: var(--primary-dark);
    }

    button:disabled {
      background: #9db8f3;
      cursor: not-allowed;
    }

    .note {
      padding: 12px;
      border-radius: 12px;
      background: #f2f6ff;
      color: var(--muted);
      font-size: 14px;
    }

    .info {
      padding: 16px;
      border-radius: 14px;
      border: 1px solid #fde68a;
      background: #fffbeb;
      color: #92400e;
      font-size: 14px;
    }

    .status {
      padding: 12px;
      border-radius: 12px;
      background: #f4f8f3;
      border: 1px solid #c9e7d4;
      color: var(--success);
      font-weight: 600;
      font-size: 14px;
    }

    .status-card {
      display: grid;
      gap: 16px;
    }

    .process-card {
      display: grid;
      gap: 16px;
    }

    .process-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .process-tag {
      font-size: 12px;
      font-weight: 600;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(31, 111, 235, 0.12);
      color: var(--primary);
    }

    .process-stepper {
      position: relative;
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 0;
      padding: 0 6px;
    }

    .process-stepper::before {
      content: "";
      position: absolute;
      top: 14px;
      left: 28px;
      right: 28px;
      height: 2px;
      background: #e6ecf5;
      z-index: 0;
    }

    .process-step {
      display: grid;
      gap: 6px;
      justify-items: center;
      text-align: center;
      position: relative;
      z-index: 1;
      padding: 0 6px;
    }

    .process-circle {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      font-size: 13px;
      font-weight: 700;
      background: #eef2f8;
      color: #7b8798;
      border: 2px solid #dde4ef;
    }

    .process-label {
      font-size: 12px;
      color: var(--muted);
      font-weight: 600;
    }

    .process-step.done .process-circle {
      background: #ecfdf3;
      border-color: #bbf7d0;
      color: #166534;
    }

    .process-step.active .process-circle {
      background: rgba(31, 111, 235, 0.12);
      border-color: rgba(31, 111, 235, 0.45);
      color: var(--primary);
    }

    .process-step.active .process-label {
      color: var(--text);
    }

    .process-step.error .process-circle {
      background: #fef2f2;
      border-color: #fecaca;
      color: #991b1b;
    }

    .process-body {
      display: grid;
      gap: 10px;
    }

    .process-title {
      font-size: 18px;
      margin: 0;
    }

    .process-subtitle {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.5;
    }

    .process-mini {
      display: grid;
      gap: 6px;
      font-size: 13px;
      color: var(--muted);
    }

    .process-mini span strong {
      color: var(--text);
    }

    .process-cta {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 16px;
      border-radius: 10px;
      background: var(--primary);
      color: #fff;
      font-weight: 600;
      text-decoration: none;
      width: fit-content;
    }

    .process-cta:hover {
      background: var(--primary-dark);
    }

    .process-note {
      font-size: 12px;
      color: var(--muted);
    }

    .status-title {
      font-size: 18px;
      margin-bottom: 0;
    }

    .status-text {
      font-size: 24px;
      font-weight: 700;
      color: var(--text);
    }

    .status-subtitle {
      margin: 0;
      color: var(--muted);
    }

    .status-progress {
      height: 10px;
      border-radius: 999px;
      background: #e8eef9;
      overflow: hidden;
      position: relative;
    }

    .status-progress::after {
      content: "";
      position: absolute;
      inset: 0;
      width: 45%;
      background: linear-gradient(90deg, rgba(31, 111, 235, 0.2), rgba(31, 111, 235, 0.8));
      animation: progressMove 2s infinite ease-in-out;
    }

    @keyframes progressMove {
      0% {
        transform: translateX(-60%);
      }
      100% {
        transform: translateX(200%);
      }
    }

    .result-card {
      display: grid;
      gap: 16px;
    }

    .result-empty {
      display: grid;
      gap: 12px;
      align-items: center;
      text-align: center;
      padding: 12px 8px 18px;
    }

    .result-empty-icon {
      width: 64px;
      height: 64px;
      border-radius: 18px;
      margin: 0 auto;
      display: grid;
      place-items: center;
      background: #eef2ff;
      color: #4338ca;
    }

    .result-amount {
      font-size: 32px;
      font-weight: 700;
      color: var(--text);
    }

    .result-meta {
      font-size: 13px;
      color: var(--muted);
    }

    .petition-card {
      display: grid;
      gap: 16px;
    }

    .preview {
      padding: 14px;
      border-radius: 12px;
      border: 1px dashed #cfd8e6;
      background: #f8fafc;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.6;
      position: relative;
      overflow: hidden;
    }

    .preview::after {
      content: "";
      position: absolute;
      inset: 0;
      backdrop-filter: blur(4px);
      background: rgba(255, 255, 255, 0.6);
    }

    .preview.active::after {
      display: none;
    }

    .petition-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .petition-actions button {
      background: #fff;
      color: var(--primary);
      border: 1px solid #d7e3f8;
    }

    .petition-actions button.primary {
      background: var(--primary);
      color: #fff;
      border: none;
    }

    .card-grid {
      display: grid;
      gap: 16px;
    }

    .action-bar {
      position: sticky;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 16px 20px;
      border-radius: 16px;
      background: #ffffff;
      border: 1px solid var(--border);
      box-shadow: 0 -12px 24px rgba(15, 23, 42, 0.08);
    }

    .action-info {
      font-size: 14px;
      color: var(--muted);
      font-weight: 600;
    }

    .action-button {
      min-width: 220px;
    }

    .state-section {
      display: none;
    }

    [data-ui-state="empty"] .state-empty,
    [data-ui-state="loading"] .state-loading,
    [data-ui-state="success"] .state-success,
    [data-ui-state="error"] .state-error {
      display: block;
    }

    [data-ui-state="success"] .toast-success,
    [data-ui-state="error"] .toast-error {
      display: flex;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.45);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-backdrop.active {
      display: flex;
    }

    .modal {
      background: #fff;
      border-radius: 16px;
      max-width: 560px;
      width: 100%;
      padding: 24px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.2);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .modal-close {
      background: transparent;
      color: var(--muted);
      border: none;
      font-size: 16px;
      cursor: pointer;
    }

    .steps {
      display: grid;
      gap: 12px;
    }

    .step {
      display: flex;
      gap: 12px;
      align-items: center;
      padding: 12px;
      border-radius: 12px;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
    }

    .step span {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      background: rgba(31, 111, 235, 0.12);
      color: var(--primary);
      font-weight: 700;
    }

    .list {
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
    }

    .app-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 16px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: #ffffff;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
    }

    .app-bar-brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      color: var(--text);
    }

    .app-bar-logo {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      background: rgba(31, 111, 235, 0.12);
      color: var(--primary);
      font-weight: 700;
    }

    .app-bar-title {
      font-size: 14px;
      color: var(--muted);
      font-weight: 600;
    }

    .is-hidden {
      display: none !important;
    }

    @media (max-width: 719px) {
      .layout {
        display: flex;
        flex-direction: column;
      }

      #stageTwo {
        order: 2;
      }

      #stageOne {
        order: 1;
        padding: 14px;
      }

      #stageOne h1 {
        font-size: 18px;
      }

      #stageOne .list {
        display: none;
      }

      .stage-one {
        gap: 14px;
      }

      .hero-title-lg {
        font-size: 22px;
      }
    }

    .result {
      border: 1px solid #d7e3f8;
      background: #f3f7ff;
      border-radius: 12px;
      padding: 16px;
    }

    .result a {
      display: inline-flex;
      margin-top: 8px;
      color: var(--primary);
      font-weight: 600;
      text-decoration: none;
    }

    .result a:hover {
      text-decoration: underline;
    }

    .meta {
      display: grid;
      gap: 8px;
      font-size: 14px;
      color: var(--muted);
    }

    .meta strong {
      color: var(--text);
    }

    .upload-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .upload-actions button {
      flex: 1;
      min-width: 220px;
    }

    .help-card ul {
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
    }

    .doc-requirements {
      display: grid;
      gap: 10px;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid #dbeafe;
      background: #f0f7ff;
      color: var(--text);
      font-size: 14px;
    }

    .doc-requirements strong {
      font-size: 15px;
    }

    .doc-requirements ul {
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
    }

    .trust-card {
      display: grid;
      gap: 12px;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid #e2e8f0;
      background: #f8fafc;
      font-size: 14px;
      color: var(--muted);
    }

    .trust-card ul {
      margin: 0;
      padding-left: 18px;
    }

    .stage-one {
      display: grid;
      gap: 16px;
    }

    .trust-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 16px;
      border-radius: 14px;
      background: #f0f6ff;
      border: 1px solid #dbe7ff;
      font-size: 13px;
      color: #2b3b55;
    }

    .trust-bar-items {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .trust-item {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }

    .trust-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #1f6feb;
    }

    .trust-link {
      color: var(--primary);
      font-weight: 600;
      text-decoration: none;
    }

    .trust-link:hover {
      text-decoration: underline;
    }

    .hero-block {
      padding: 24px;
      border-radius: 18px;
      background: #ffffff;
      border: 1px solid var(--border);
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.08);
      display: grid;
      gap: 12px;
    }

    .hero-title-lg {
      font-size: 26px;
      line-height: 1.25;
    }

    .hero-subtitle {
      font-size: 15px;
      color: var(--muted);
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .pill {
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(31, 111, 235, 0.12);
      color: #1747b8;
      font-weight: 600;
      font-size: 12px;
    }

    .steps-block {
      display: grid;
      gap: 12px;
    }

    .steps-grid {
      display: grid;
      gap: 12px;
    }

    .step-card {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid #e2e8f0;
      background: #f8fafc;
    }

    .step-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      background: rgba(31, 111, 235, 0.12);
      color: var(--primary);
    }

    .lawyers-block {
      display: grid;
      gap: 14px;
    }

    .lawyers-grid {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    .lawyer-card {
      position: relative;
      padding: 16px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: #ffffff;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.06);
      display: grid;
      gap: 10px;
    }

    .lawyer-tag {
      position: absolute;
      top: 12px;
      right: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(31, 111, 235, 0.12);
      color: var(--primary);
      font-size: 11px;
      font-weight: 700;
    }

    .lawyer-profile {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .lawyer-avatar {
      width: 52px;
      height: 52px;
      border-radius: 16px;
      background: linear-gradient(135deg, #e3ecff, #f8fbff);
      display: grid;
      place-items: center;
      color: #3558b8;
      font-weight: 700;
    }

    .lawyer-meta {
      display: grid;
      gap: 4px;
    }

    .lawyer-name {
      font-weight: 700;
    }

    .lawyer-title {
      font-size: 13px;
      color: var(--muted);
    }

    .lawyer-city {
      font-size: 12px;
      color: #4b5563;
      font-weight: 600;
    }

    .lawyer-actions {
      display: flex;
      justify-content: flex-end;
    }

    .lawyer-link {
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid #dbe4f5;
      background: #f8fbff;
      color: #2b4a8f;
      font-size: 12px;
      font-weight: 600;
    }

    .lawyer-note {
      font-size: 13px;
      color: var(--muted);
    }

    .lawyer-referral {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: var(--muted);
    }

    .lawyer-referral label {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .secondary-button {
      border-radius: 999px;
      padding: 8px 14px;
      border: 1px solid #c7d2e7;
      background: transparent;
      color: #1f3f7a;
      font-weight: 600;
      font-size: 13px;
    }

    .secondary-button:hover {
      background: #f2f6ff;
    }

    .automation-block {
      display: grid;
      gap: 16px;
      padding: 22px;
      border-radius: 20px;
      border: 1px solid #dbe7ff;
      background: linear-gradient(135deg, #ffffff 0%, #f5f9ff 100%);
      box-shadow: 0 16px 32px rgba(15, 23, 42, 0.08);
    }

    .automation-grid {
      display: grid;
      gap: 16px;
    }

    .automation-card {
      display: grid;
      gap: 8px;
      padding: 16px;
      border-radius: 16px;
      border: 1px solid #e2e8f0;
      background: #ffffff;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.06);
    }

    .automation-card strong {
      font-size: 15px;
    }

    .automation-icon {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      background: rgba(31, 111, 235, 0.12);
      color: var(--primary);
    }

    .founders-block {
      display: grid;
      gap: 14px;
    }

    .founders-grid {
      display: grid;
      gap: 14px;
    }

    .founder-card {
      display: grid;
      gap: 10px;
      padding: 16px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: #ffffff;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.06);
    }

    .founder-header {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .founder-avatar {
      width: 52px;
      height: 52px;
      border-radius: 16px;
      background: linear-gradient(135deg, #e6f0ff, #f9fbff);
      display: grid;
      place-items: center;
      font-weight: 700;
      color: #2e4aa1;
    }

    .founder-name {
      font-weight: 700;
    }

    .founder-role {
      font-size: 13px;
      color: var(--muted);
      font-weight: 600;
    }

    .modal-form {
      display: grid;
      gap: 12px;
    }

    .modal-form input {
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid #d6deea;
      font-size: 14px;
      font-family: inherit;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
    }

    .cta-block {
      display: grid;
      gap: 10px;
      padding: 20px;
      border-radius: 18px;
      border: 1px solid #dbeafe;
      background: #f7faff;
    }

    .cta-button {
      width: 100%;
      padding: 16px 20px;
      font-size: 16px;
      border-radius: 14px;
    }

    .cta-meta {
      font-size: 13px;
      color: var(--muted);
    }

    .cta-warning {
      font-size: 12px;
      color: #92400e;
      background: #fff7ed;
      border-radius: 10px;
      padding: 8px 10px;
      border: 1px solid #fed7aa;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .catch-cta {
      display: grid;
      gap: 12px;
      border-radius: 18px;
      background: linear-gradient(135deg, #ffffff 0%, #f3f7ff 100%);
      border: 1px solid #dbe7ff;
      padding: 20px;
    }

    .catch-cta p {
      margin: 0;
    }

    .outline-button {
      border: 1px solid #c7d2e7;
      background: transparent;
      color: #1f3f7a;
    }

    .outline-button:hover {
      background: #f2f6ff;
    }

    .catch-cta .outline-button {
      width: 100%;
      border-radius: 12px;
      padding: 14px 18px;
    }

    @media (min-width: 720px) {
      #app {
        padding: 40px;
        max-width: 1100px;
        margin: 0 auto;
      }

      .layout {
        display: flex;
        flex-direction: column;
        gap: 20px;
        align-items: center;
      }

      #stageOne,
      #stageTwo {
        width: 100%;
        max-width: 780px;
        margin: 0 auto;
      }

      .app-bar {
        display: none;
      }

      .hero-card {
        padding: 20px;
      }

      .hero-title {
        font-size: 22px;
      }

      #processCard {
        max-width: 780px;
        margin: 0 auto;
      }

      .card:hover {
        transform: none;
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.1);
      }
    }

    @media (min-width: 960px) {
      .stage-one {
        display: grid;
        grid-template-columns: 1fr 1fr;
        align-items: start;
      }

      .stage-one > :nth-child(1) {
        grid-column: 1;
      }

      .stage-one > :nth-child(3) {
        grid-column: 2;
      }

      .trust-bar {
        grid-column: 1 / -1;
      }

      .steps-block,
      .automation-block,
      .lawyers-block,
      .founders-block {
        grid-column: 1 / -1;
      }

      .card-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .card-grid .card:last-child {
        grid-column: span 2;
      }

      .automation-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .founders-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .catch-cta {
        grid-template-columns: 1fr auto;
        align-items: center;
      }

      .catch-cta .outline-button {
        width: auto;
        min-width: 220px;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <section class="layout">
      <div class="card stack" id="stageOne">
        <div class="stage-one">
          <section class="cta-block" id="primaryCta">
            <button type="button" id="calculateButton" class="cta-button">Değer Kaybımı Hesapla</button>
            <div class="cta-meta">Ortalama süre: 1–2 dakika</div>
            <div class="cta-meta">Hesaplama tamamlandığında belgeleriniz otomatik silinir.</div>
            <div class="cta-meta">Bu hesaplama bir tahmindir; nihai tutar tahkim bilirkişisiyle belirlenir.</div>
            <div class="cta-warning is-hidden" id="missingDocsNote">
              Devam etmek için zorunlu evrakları yükleyin.
            </div>
          </section>

          <div class="trust-bar">
            <div class="trust-bar-items">
              <span class="trust-item">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M7 11V8a5 5 0 0 1 10 0v3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <rect x="5" y="11" width="14" height="10" rx="2" stroke="currentColor" stroke-width="2"/>
                </svg>
                Belgeleriniz şifreli işlenir.
              </span>
              <span class="trust-item">
                <span class="trust-dot" aria-hidden="true"></span>
                Hesaplama tamamlandığında belgeleriniz otomatik silinir.
              </span>
            </div>
            <a class="trust-link" href="#" id="trustDetailsLink">Detaylar</a>
          </div>

          <section class="hero-block">
            <h1 class="hero-title-lg">Değer Kaybı Hesaplama ve Başvuru Otomasyonu</h1>
            <p class="hero-subtitle">
              Evraklarınızdan tutarı hesaplar, başvuru dilekçesini sizin adınıza güvenle hazırlar.
            </p>
            <div class="pill-row" aria-label="Güven rozetleri">
              <span class="pill">Şifreli İşleme</span>
              <span class="pill">Otomatik Silme</span>
              <span class="pill">Avukat Destekli</span>
            </div>
          </section>

          <section class="steps-block">
            <h2>Nasıl İlerler?</h2>
            <div class="steps-grid">
              <div class="step-card">
                <span class="step-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M4 7h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <rect x="4" y="7" width="16" height="12" rx="2" stroke="currentColor" stroke-width="2"/>
                  </svg>
                </span>
                <div>
                  <strong>Evrakları yükleyin</strong>
                  <p>Belgeler net ve eksiksiz olmalı.</p>
                </div>
              </div>
              <div class="step-card">
                <span class="step-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M5 12l4 4L19 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </span>
                <div>
                  <strong>Okunabilirlik kontrolü</strong>
                  <p>Uygunluk ve netlik otomatik doğrulanır.</p>
                </div>
              </div>
              <div class="step-card">
                <span class="step-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M12 6v12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M6 12h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </span>
                <div>
                  <strong>Hesaplamayı başlatın</strong>
                  <p>Tek tıkla tutar oluşturulur.</p>
                </div>
              </div>
            </div>
          </section>

          <section class="automation-block">
            <div>
              <h2>GAIA Otomasyonu ile Tam Şeffaf Takip</h2>
              <p class="hero-subtitle">
                Tahkim dosyalarında her adım kayıtlıdır. Müvekkil ve ofisler için otomatik bilgilendirme ve takip
                kolaylığı sunar.
              </p>
            </div>
            <div class="automation-grid">
              <article class="automation-card">
                <div class="automation-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M4 6h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <rect x="4" y="6" width="16" height="12" rx="2" stroke="currentColor" stroke-width="2"/>
                  </svg>
                </div>
                <strong>Tahkim dosyalarında tam şeffaflık</strong>
                <p>Süreç, belgeler ve adımlar tek ekranda izlenir.</p>
              </article>
              <article class="automation-card">
                <div class="automation-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M7 4h10v16H7z" stroke="currentColor" stroke-width="2"/>
                    <path d="M9 8h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </div>
                <strong>Müvekkil dosya takip ekranı</strong>
                <p>Müvekkiller her aşamayı kendi panelinden görür.</p>
              </article>
              <article class="automation-card">
                <div class="automation-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M6 12h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M12 6v12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </div>
                <strong>SMS ile anlık bilgilendirme</strong>
                <p>Her kritik adımda otomatik SMS gider.</p>
              </article>
              <article class="automation-card">
                <div class="automation-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M4 8h16v10H4z" stroke="currentColor" stroke-width="2"/>
                    <path d="M4 8l8 6 8-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </div>
                <strong>Avukatlık ofislerine e-posta güncellemeleri</strong>
                <p>Sürekli manuel takip ihtiyacını azaltır.</p>
              </article>
              <article class="automation-card">
                <div class="automation-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M4 12h8l2 3 4-6 2 3h2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </div>
                <strong>Yapay zekâ ile daha hızlı takip</strong>
                <p>Özetler, uyarılar ve aksiyon önerileri üretir.</p>
              </article>
              <article class="automation-card">
                <div class="automation-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M7 7h10v10H7z" stroke="currentColor" stroke-width="2"/>
                    <path d="M12 3v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </div>
                <strong>Ödeme/harç/bilirkişi uyarı sistemi</strong>
                <p>Dosyayı aksatabilecek gecikmeleri önceden bildirir.</p>
              </article>
            </div>
          </section>

          <section class="lawyers-block">
            <div>
              <h2>Otomasyonumuzu Kullanan Avukatlar</h2>
              <p class="hero-subtitle">
                Süreç tasarımımız, trafik ve sigorta hukuku alanında çalışan avukatların sahadaki uygulamalarıyla
                uyumludur.
              </p>
            </div>
            <div class="lawyers-grid">
              <article class="lawyer-card">
                <span class="lawyer-tag">Referans</span>
                <div class="lawyer-profile">
                  <div class="lawyer-avatar" aria-hidden="true">AK</div>
                  <div class="lawyer-meta">
                    <div class="lawyer-name">Aylin Kaya</div>
                    <div class="lawyer-title">Trafik Hukuku / Sigorta Hukuku</div>
                    <div class="lawyer-city">İstanbul</div>
                  </div>
                </div>
                <div class="lawyer-actions">
                  <button type="button" class="lawyer-link">Profili gör</button>
                </div>
              </article>
              <article class="lawyer-card">
                <span class="lawyer-tag">Referans</span>
                <div class="lawyer-profile">
                  <div class="lawyer-avatar" aria-hidden="true">MS</div>
                  <div class="lawyer-meta">
                    <div class="lawyer-name">Mehmet Şahin</div>
                    <div class="lawyer-title">Trafik Hukuku / Sigorta Hukuku</div>
                    <div class="lawyer-city">Ankara</div>
                  </div>
                </div>
                <div class="lawyer-actions">
                  <button type="button" class="lawyer-link">Profili gör</button>
                </div>
              </article>
              <article class="lawyer-card">
                <span class="lawyer-tag">Referans</span>
                <div class="lawyer-profile">
                  <div class="lawyer-avatar" aria-hidden="true">ED</div>
                  <div class="lawyer-meta">
                    <div class="lawyer-name">Elif Demir</div>
                    <div class="lawyer-title">Trafik Hukuku / Sigorta Hukuku</div>
                    <div class="lawyer-city">İzmir</div>
                  </div>
                </div>
                <div class="lawyer-actions">
                  <button type="button" class="lawyer-link">Profili gör</button>
                </div>
              </article>
              <article class="lawyer-card">
                <span class="lawyer-tag">Referans</span>
                <div class="lawyer-profile">
                  <div class="lawyer-avatar" aria-hidden="true">OK</div>
                  <div class="lawyer-meta">
                    <div class="lawyer-name">Onur Karaca</div>
                    <div class="lawyer-title">Trafik Hukuku / Sigorta Hukuku</div>
                    <div class="lawyer-city">Bursa</div>
                  </div>
                </div>
                <div class="lawyer-actions">
                  <button type="button" class="lawyer-link">Profili gör</button>
                </div>
              </article>
            </div>
            <div class="lawyer-referral">
              <label>
                <input type="checkbox" id="lawyerReferralCheck" />
                İsterseniz danışmanlık için avukat yönlendirmesi isteyebilirsiniz.
              </label>
              <button type="button" class="secondary-button" id="lawyerReferralButton">Avukat yönlendirmesi iste</button>
            </div>
          </section>

          <section class="founders-block">
            <div>
              <h2>Biz Kimiz?</h2>
              <p class="hero-subtitle">Sigorta hukuku süreçlerini otomasyonla sadeleştiriyoruz.</p>
            </div>
            <div class="founders-grid">
              <article class="founder-card">
                <div class="founder-header">
                  <div class="founder-avatar" aria-hidden="true">SK</div>
                  <div>
                    <div class="founder-name">Saltuk Kıraç</div>
                    <div class="founder-role">GAIA Kurucusu</div>
                  </div>
                </div>
                <p>Süreç tasarımı ve operasyonel otomasyon odaklı.</p>
              </article>
              <article class="founder-card">
                <div class="founder-header">
                  <div class="founder-avatar" aria-hidden="true">MK</div>
                  <div>
                    <div class="founder-name">Mevlüt Kıraç</div>
                    <div class="founder-role">Sigorta Hukuku Otomasyonu Kurucusu</div>
                  </div>
                </div>
                <p>Süreç tasarımı ve operasyonel otomasyon odaklı.</p>
              </article>
            </div>
          </section>

          <section class="catch-cta card">
            <div>
              <h2>Hızlıca hesaplayın</h2>
              <p>1–2 dakikada tahmini tutarı görün, başvuru için hazırlanın.</p>
            </div>
            <button type="button" class="outline-button" id="catchCtaButton">Yukarı çık ve Hesapla</button>
          </section>
        </div>
      </div>
      <main class="main-panel" id="stageTwo" data-ui-state="empty">
        <div class="toast toast-error state-error">
          Bazı belgeler okunamıyor. Lütfen sol panelden kontrol edin.
        </div>
        <div class="toast toast-success state-success">
          Hesaplama tamamlandı. Dilekçeniz hazır.
        </div>

        <div class="app-bar" aria-label="Uygulama üst barı">
          <div class="app-bar-brand">
            <div class="app-bar-logo" aria-hidden="true">DK</div>
            <div>
              <div>Değer Kaybı</div>
              <div class="app-bar-title">Hızlı Hesaplama</div>
            </div>
          </div>
          <span class="secure-note">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M7 11V8a5 5 0 0 1 10 0v3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <rect x="5" y="11" width="14" height="10" rx="2" stroke="currentColor" stroke-width="2"/>
            </svg>
            Güvenli başvuru
          </span>
        </div>

        <section class="summary-card" id="summaryCard" aria-live="polite">
          <div class="summary-header">
            <div>
              <span class="badge">Sonuç Özeti</span>
              <h2 class="hero-title">Hesaplama ve İhtar Bilgisi</h2>
              <p class="summary-meta" id="summaryStatus">
                Henüz hesaplama yapılmadı. Evraklar yüklendiyse hesaplamayı başlatabilirsiniz.
              </p>
            </div>
            <div class="summary-amount" id="summaryAmount">₺ --</div>
          </div>
          <div class="summary-actions">
            <button type="button" class="primary" id="summaryCalculateButton">Hesapla</button>
            <a class="outline-button is-hidden" id="summaryDownload" href="#" target="_blank" rel="noopener">
              İhtar Dilekçesini İndir
            </a>
          </div>
          <div class="summary-meta" id="summaryDate">Hesaplama tarihi: --</div>
        </section>

        <header class="hero-card">
          <div class="hero-top">
            <div>
              <span class="badge">Güvenli Başvuru</span>
              <h1 class="hero-title">Değer Kaybı Hesaplama ve Dilekçe Oluşturma</h1>
              <p>
                Belgeleriniz yüklendikten sonra sistemimiz tahmini değer kaybı tutarını hesaplar ve başvuru dilekçenizi
                otomatik hazırlar.
              </p>
            </div>
            <div class="hero-actions">
              <a class="hero-actions-link" href="#" id="howItWorksLink">Nasıl Çalışır?</a>
              <div>
                <span class="secure-note">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M7 11V8a5 5 0 0 1 10 0v3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <rect x="5" y="11" width="14" height="10" rx="2" stroke="currentColor" stroke-width="2"/>
                  </svg>
                  Verileriniz güvenle işlenir
                </span>
                <span class="secure-meta">256-bit şifreleme ile korunur.</span>
              </div>
            </div>
          </div>
        </header>

        <section class="card-grid">
          <article class="card process-card is-hidden" id="processCard" aria-hidden="true" tabindex="-1">
            <div class="process-header">
              <h2 class="status-title">Süreç Takibi</h2>
              <span class="process-tag" id="processTag">Belgeler bekleniyor</span>
            </div>
            <div class="process-stepper" id="processStepper" aria-label="Süreç adımları">
              <div class="process-step pending" data-step="1">
                <span class="process-circle">1</span>
                <span class="process-label">Belgeler alındı</span>
              </div>
              <div class="process-step pending" data-step="2">
                <span class="process-circle">2</span>
                <span class="process-label">Bilgiler çıkarılıyor</span>
              </div>
              <div class="process-step pending" data-step="3">
                <span class="process-circle">3</span>
                <span class="process-label">Değer kaybı tahmini</span>
              </div>
              <div class="process-step pending" data-step="4">
                <span class="process-circle">4</span>
                <span class="process-label">İhtar dilekçesi</span>
              </div>
            </div>
            <div class="process-body">
              <h3 class="process-title" id="processTitle">Belgeler bekleniyor</h3>
              <p class="process-subtitle" id="processSubtitle">
                Süreç başladığında adım adım bilgilendirileceksiniz.
              </p>
              <div class="process-mini is-hidden" id="processMini"></div>
              <a class="process-cta is-hidden" id="processCta" href="#" target="_blank" rel="noopener">İhtar Dilekçesini İndir</a>
              <div class="process-note is-hidden" id="processNote"></div>
            </div>
          </article>

          <article class="card status-card" id="statusCard">
            <h2 class="status-title">Başvuru Durumu</h2>
            <div class="status-text" id="statusStateLabel">Belgeler kontrol ediliyor</div>
            <p class="status-subtitle">
              Zorunlu belgeler yüklendiğinde hesaplama otomatik başlar.
            </p>
            <div class="status-progress" aria-hidden="true"></div>
            <p class="result-meta">
              Belgeleriniz yalnızca bu başvuru için kullanılır ve 256-bit şifreleme ile korunur.
            </p>
          </article>

          <article class="card result-card is-hidden" id="resultCard">
            <h2 class="status-title">Hesaplama Çıktısı</h2>
            <div class="state-section state-empty">
              <div class="result-empty">
                <div class="result-empty-icon" aria-hidden="true">
                  <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                    <path d="M3 6h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M8 6V4h8v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <rect x="5" y="6" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                  </svg>
                </div>
                <strong>Hesaplama için belgelerinizi sol panelden yükleyin.</strong>
                <span class="result-meta">Genellikle işlem 30–60 saniye sürer.</span>
              </div>
            </div>
            <div class="state-section state-loading">
              <div class="status-text">Hesaplama sürüyor</div>
              <p class="status-subtitle">Sonuç oluşturulduğunda burada görünecek.</p>
              <div class="status-progress" aria-hidden="true"></div>
            </div>
            <div class="state-section state-success">
              <div class="result-amount" id="resultAmount">₺ 24.750</div>
              <p class="status-subtitle">Tahmini Değer Kaybı Tutarı</p>
              <p class="status-subtitle">
                Bu tutar yüklenen belgelere göre hesaplanmıştır ve resmi başvuruda kullanılabilir.
              </p>
              <div class="result-meta" id="resultDate">Hesaplama tarihi: 12/04/2024</div>
            </div>
            <div class="state-section state-error">
              <div class="status-text">Hesaplama tamamlanamadı</div>
              <p class="status-subtitle">Belgeler kontrol edilip yeniden denenecek.</p>
            </div>
          </article>

          <article class="card petition-card is-hidden" id="petitionCard">
            <h2 class="status-title">Başvuru Dilekçesi</h2>
            <p class="status-subtitle">
              Hesaplanan tutara göre resmi başvuru metni otomatik oluşturulur.
            </p>
            <div class="state-section state-empty">
              <p class="status-subtitle">Hesaplama tamamlandığında dilekçe hazır olacaktır.</p>
            </div>
            <div class="state-section state-loading">
              <p class="status-subtitle">Dilekçe hazırlanıyor. Kısa süre içinde paylaşılacak.</p>
            </div>
            <div class="state-section state-success">
              <div class="preview active">
                Sayın ilgili makam,<br/>
                Trafik kazası sonrası oluşan değer kaybı için başvurumu iletiyorum. Eklerde yer alan belgeler doğrultusunda
                yapılan hesaplamaya göre talebim tarafınıza sunulmuştur...
              </div>
              <div class="petition-actions">
                <a class="process-cta is-hidden" id="petitionDownload" href="#" target="_blank" rel="noopener">İhtar Dilekçesini İndir</a>
                <button type="button" class="outline-button">Word İndir</button>
                <button type="button" class="primary">Kopyala</button>
              </div>
            </div>
            <div class="state-section state-error">
              <p class="status-subtitle">Dilekçe hazırlanamadı. Belgeler kontrol edilince otomatik devam eder.</p>
            </div>
          </article>
        </section>

        <div class="action-bar" id="actionBar">
          <div class="action-info">Ortalama işlem süresi: 2–4 dakika</div>
          <button class="action-button" id="actionButton" type="button" disabled>Belgeler Bekleniyor</button>
        </div>
      </main>
    </section>
  </div>

  <div class="modal-backdrop" id="trustDetailsModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="trustDetailsTitle">
      <div class="modal-header">
        <h3 id="trustDetailsTitle">Detaylar</h3>
        <button class="modal-close" type="button" id="closeTrustModalButton">Kapat</button>
      </div>
      <ul class="list">
        <li>Belgeler sadece hesaplama ve dilekçe üretimi için kullanılır.</li>
        <li>Hesaplama tamamlandığında belgeleriniz otomatik silinir.</li>
        <li>Paylaşım yapılmaz, üçüncü taraf erişimi yoktur.</li>
        <li>Yasal saklama zorunluluğu olmadıkça sistemde tutulmaz.</li>
        <li>Silme süreci otomatik çalışır, manuel işlem gerekmez.</li>
      </ul>
    </div>
  </div>

  <div class="modal-backdrop" id="lawyerReferralModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="lawyerReferralTitle">
      <div class="modal-header">
        <h3 id="lawyerReferralTitle">Avukat Yönlendirmesi</h3>
        <button class="modal-close" type="button" id="closeLawyerReferralModal">Kapat</button>
      </div>
      <p class="hero-subtitle">İletişim bilgilerinizi bırakın, sizinle dönüş yapalım.</p>
      <form class="modal-form">
        <input type="text" name="fullName" placeholder="Ad Soyad" />
        <input type="tel" name="phone" placeholder="Telefon numarası" />
        <div class="modal-actions">
          <button type="button" class="secondary-button">Gönder</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal-backdrop" id="howItWorksModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="howItWorksTitle">
      <div class="modal-header">
        <h3 id="howItWorksTitle">Nasıl Çalışır?</h3>
        <button class="modal-close" type="button" id="closeModalButton">Kapat</button>
      </div>
      <div class="steps">
        <div class="step">
          <span>1</span>
          <div>
            <strong>Belgeler doğrulanır.</strong>
            <p>Yüklediğiniz evraklar okunabilirlik ve doğruluk açısından kontrol edilir.</p>
          </div>
        </div>
        <div class="step">
          <span>2</span>
          <div>
            <strong>Değer kaybı hesaplanır.</strong>
            <p>Belgelerinizden alınan bilgilerle tahmini tutar hızlıca oluşturulur.</p>
          </div>
        </div>
        <div class="step">
          <span>3</span>
          <div>
            <strong>Dilekçe hazırlanır.</strong>
            <p>Hesaplama sonucuna göre başvuru metni otomatik olarak hazırlanır.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      let evraklarYuklendi = window.EVRAKLAR_YUKLENDI;
      const resultDataJson = window.RESULT_DATA_JSON;

      const stageOne = document.getElementById("stageOne");
      const stageTwo = document.getElementById("stageTwo");
      const primaryCta = document.getElementById("primaryCta");
      const calculateButton = document.getElementById("calculateButton");
      const catchCtaButton = document.getElementById("catchCtaButton");
      const actionButton = document.getElementById("actionButton");
      const statusStateLabel = document.getElementById("statusStateLabel");
      const resultAmount = document.getElementById("resultAmount");
      const resultDate = document.getElementById("resultDate");
      const resultCard = document.getElementById("resultCard");
      const petitionCard = document.getElementById("petitionCard");
      const statusCard = document.getElementById("statusCard");
      const actionBar = document.getElementById("actionBar");
      const howItWorksLink = document.getElementById("howItWorksLink");
      const howItWorksModal = document.getElementById("howItWorksModal");
      const closeModalButton = document.getElementById("closeModalButton");
      const trustDetailsLink = document.getElementById("trustDetailsLink");
      const trustDetailsModal = document.getElementById("trustDetailsModal");
      const closeTrustModalButton = document.getElementById("closeTrustModalButton");
      const missingDocsNote = document.getElementById("missingDocsNote");
      const lawyerReferralButton = document.getElementById("lawyerReferralButton");
      const lawyerReferralModal = document.getElementById("lawyerReferralModal");
      const closeLawyerReferralModal = document.getElementById("closeLawyerReferralModal");
      const processCard = document.getElementById("processCard");
      const processTag = document.getElementById("processTag");
      const processTitle = document.getElementById("processTitle");
      const processSubtitle = document.getElementById("processSubtitle");
      const processMini = document.getElementById("processMini");
      const processCta = document.getElementById("processCta");
      const processNote = document.getElementById("processNote");
      const petitionDownload = document.getElementById("petitionDownload");
      const summaryCard = document.getElementById("summaryCard");
      const summaryStatus = document.getElementById("summaryStatus");
      const summaryAmount = document.getElementById("summaryAmount");
      const summaryDate = document.getElementById("summaryDate");
      const summaryDownload = document.getElementById("summaryDownload");
      const summaryCalculateButton = document.getElementById("summaryCalculateButton");
      const processSteps = processCard ? processCard.querySelectorAll(".process-step") : [];

      function setUiState(state) {
        stageTwo.dataset.uiState = state;
      }

      const PROCESS_ACTIVE_KEY = "processActive";
      let hasStartedCalculation = false;
      let PIN_PROCESS_CARD = false;
      const initialPayload = resolveResultPayload(resultDataJson);
      let currentResultJson = initialPayload.raw;

      function readPersistedProcessActive() {
        try {
          const sessionValue = sessionStorage.getItem(PROCESS_ACTIVE_KEY);
          if (sessionValue !== null) {
            return sessionValue === "true";
          }
        } catch (error) {
          console.warn("processActive sessionStorage okunamadı", error);
        }
        try {
          const localValue = localStorage.getItem(PROCESS_ACTIVE_KEY);
          if (localValue !== null) {
            return localValue === "true";
          }
        } catch (error) {
          console.warn("processActive localStorage okunamadı", error);
        }
        return false;
      }

      function persistProcessActive(isActive) {
        try {
          sessionStorage.setItem(PROCESS_ACTIVE_KEY, String(isActive));
        } catch (error) {
          console.warn("processActive sessionStorage yazılamadı", error);
        }
        try {
          localStorage.setItem(PROCESS_ACTIVE_KEY, String(isActive));
        } catch (error) {
          console.warn("processActive localStorage yazılamadı", error);
        }
      }

      function setProcessCardVisibility(isVisible) {
        if (!processCard) {
          return;
        }
        processCard.classList.toggle("is-hidden", !isVisible);
        processCard.setAttribute("aria-hidden", String(!isVisible));
      }

      function moveProcessCardToTop() {
        // Artık DOM sırası sabit: processCard card-grid içinde en üstte duruyor.
        // Zıplamayı önlemek için taşıma yapmıyoruz.
      }

      function showProcessCardAtTop() {
        if (!processCard) {
          return;
        }
        hasStartedCalculation = true;
        persistProcessActive(true);
        setProcessCardVisibility(true);
        processTag.textContent = "İşleniyor";
        processTitle.textContent = "Belgeler işleniyor";
        processSubtitle.textContent = "Bu işlem sırasında aşamalar otomatik güncellenecek.";
      }

      const BUBBLE_FN_SUFFIX = "hesapla";

      function resolveBubbleFunction(fnName) {
        if (typeof window[fnName] === "function") {
          return window[fnName];
        }
        if (window.parent && typeof window.parent[fnName] === "function") {
          return window.parent[fnName];
        }
        if (window.top && typeof window.top[fnName] === "function") {
          return window.top[fnName];
        }
        return null;
      }

      function triggerBubbleFunction(suffix, payload) {
        const fnName = `bubble_fn_${suffix}`;
        const bubbleFn = resolveBubbleFunction(fnName);
        if (typeof bubbleFn === "function") {
          if (payload === undefined || payload === null) {
            console.info(`[Bubble] ${fnName} tetikleniyor (payload yok).`);
            bubbleFn();
          } else {
            const bubblePayload = typeof payload === "string" ? payload : JSON.stringify(payload);
            console.info(`[Bubble] ${fnName} tetikleniyor (payload var).`, bubblePayload);
            bubbleFn(bubblePayload);
          }
          return true;
        }
        console.warn(`[Bubble] Fonksiyon bulunamadı: ${fnName}`);
        return false;
      }

      function handleCalculateClick() {
        PIN_PROCESS_CARD = true;
        setUiState("loading");
        setStageOneHidden(true);
        setProcessVisibility(true);
        setOutputVisibility(true);
        setProcessCardVisibility(true);
        showProcessCardAtTop();
        if (statusStateLabel) {
          statusStateLabel.textContent = "Hesaplama sürüyor";
        }
        if (processCard) {
          processCard.scrollIntoView({ behavior: "smooth", block: "start" });
        }
        triggerBubbleFunction(BUBBLE_FN_SUFFIX);
      }

      if (calculateButton) {
        calculateButton.addEventListener("click", handleCalculateClick);
      }
      if (actionButton) {
        actionButton.addEventListener("click", handleCalculateClick);
      }
      if (summaryCalculateButton) {
        summaryCalculateButton.addEventListener("click", handleCalculateClick);
      }

      function scrollToPrimaryCta() {
        if (!primaryCta) {
          return;
        }
        primaryCta.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      if (catchCtaButton) {
        catchCtaButton.addEventListener("click", scrollToPrimaryCta);
      }

      function setCalculateButtonState(isReady) {
        if (!calculateButton) {
          return;
        }
        calculateButton.disabled = !isReady;
        if (missingDocsNote) {
          missingDocsNote.classList.toggle("is-hidden", isReady);
        }
      }

      function hasResultPayload(payload) {
        if (payload && typeof payload === "object") {
          return Object.keys(payload).length > 0;
        }
        return typeof payload === "string" && payload.trim() !== "";
      }

      function normalizeJsonString(value) {
        if (typeof value !== "string") {
          return "";
        }
        let normalized = value.trim();
        if (!normalized) {
          return "";
        }
        if (normalized.startsWith("'") && normalized.endsWith("'")) {
          normalized = normalized.slice(1, -1).trim();
        }
        if (normalized && !normalized.includes('"') && normalized.includes("'")) {
          normalized = normalized.replace(/'/g, '"');
        }
        return normalized;
      }

      function safeParseResultData(payload) {
        if (!payload) {
          return null;
        }
        if (payload && typeof payload === "object") {
          return payload;
        }
        if (typeof payload !== "string") {
          return null;
        }
        const jsonString = normalizeJsonString(payload);
        if (!jsonString) {
          return null;
        }
        try {
          const parsed = JSON.parse(jsonString);
          return parsed && typeof parsed === "object" ? parsed : null;
        } catch (error) {
          console.warn("invalid JSON", error);
          return null;
        }
      }

      function makeSignature(obj) {
        if (!obj || typeof obj !== "object") {
          return "null";
        }
        const pick = (key) => {
          const value = getValueByKey(obj, key);
          return value === undefined || value === null ? "" : String(value);
        };
        const urlSet = new Set();
        collectUrlsFromValue(obj, urlSet);

        return [
          `urls=${urlSet.size}`,
          `ihtar=${pick("İhtar Dilekçesi")}`,
          `dk=${pick("Hesaplanan DK") || pick("Tahmini Değer Kaybı") || pick("Değer Kaybı Tutarı")}`,
          `plaka=${pick("Karşı Plaka")}`,
          `tarih=${pick("Kaza Tarihi")}`,
          `yer=${pick("Kaza Yeri")}`,
          `status=${pick("status") || pick("error")}`,
        ].join("|");
      }

      function getValueByKey(data, key) {
        if (!data || typeof data !== "object") {
          return undefined;
        }
        if (Object.prototype.hasOwnProperty.call(data, key)) {
          return data[key];
        }
        const lowerKey = key.toLowerCase();
        for (const [entryKey, entryValue] of Object.entries(data)) {
          if (entryKey.toLowerCase() === lowerKey) {
            return entryValue;
          }
        }
        return undefined;
      }

      function stableStringify(value) {
        if (value === null || value === undefined) {
          return "";
        }
        if (typeof value !== "object") {
          return String(value);
        }
        if (Array.isArray(value)) {
          return `[${value.map((item) => stableStringify(item)).join(",")}]`;
        }
        const keys = Object.keys(value).sort();
        return `{${keys.map((key) => `${key}:${stableStringify(value[key])}`).join(",")}}`;
      }

      function resolveResultPayload(rawValue) {
        if (rawValue && typeof rawValue === "object") {
          return {
            raw: stableStringify(rawValue),
            parsed: rawValue,
          };
        }
        if (typeof rawValue === "string") {
          const normalized = normalizeJsonString(rawValue);
          return {
            raw: normalized,
            parsed: safeParseResultData(normalized),
          };
        }
        return { raw: "", parsed: null };
      }

      function buildResultSignature(rawValue, parsedValue) {
        const base = parsedValue ? stableStringify(parsedValue) : "";
        const raw = typeof rawValue === "string" ? normalizeJsonString(rawValue) : "";
        return `${base}::${raw}`.trim();
      }

      function normalizeUrlList(value) {
        if (!value) {
          return [];
        }
        const entries = [];
        if (Array.isArray(value)) {
          value.forEach((item) => {
            if (typeof item === "string") {
              entries.push(item);
            }
          });
        } else if (typeof value === "string") {
          const trimmed = value.trim();
          if (trimmed.startsWith("[") && trimmed.endsWith("]")) {
            const inner = trimmed.slice(1, -1);
            entries.push(
              ...inner
                .split(";")
                .map((entry) => entry.replace(/['"]/g, "").trim())
            );
          } else {
            entries.push(
              ...trimmed
                .split(";")
                .map((entry) => entry.trim())
            );
          }
        }
        return entries
          .map((entry) => entry.trim())
          .filter((entry) => entry.length > 0);
      }

      function normalizeIhtarUrl(urlCandidate) {
        if (!urlCandidate || typeof urlCandidate !== "string") {
          return "";
        }
        const trimmed = urlCandidate.trim();
        if (!trimmed) {
          return "";
        }
        const withProtocol = trimmed.startsWith("//") ? `https:${trimmed}` : trimmed;
        if (/^https?:\/\/\S+$/i.test(withProtocol)) {
          return withProtocol;
        }
        return "";
      }

      function findFirstValidUrl(value) {
        const items = normalizeUrlList(value);
        for (const item of items) {
          const normalized = normalizeIhtarUrl(item);
          if (normalized) {
            return normalized;
          }
        }
        return "";
      }

      function getIhtarUrl(resultData) {
        const ihtarValue = getValueByKey(resultData, "İhtar Dilekçesi");
        return findFirstValidUrl(ihtarValue);
      }

      function collectUrlsFromValue(value, urlSet) {
        if (!value) {
          return;
        }
        if (typeof value === "string") {
          const matches = value.match(/https?:\/\/[^\s"'<>]+/g);
          if (matches) {
            matches.forEach((match) => urlSet.add(match));
          }
          return;
        }
        if (Array.isArray(value)) {
          value.forEach((entry) => collectUrlsFromValue(entry, urlSet));
          return;
        }
        if (typeof value === "object") {
          Object.values(value).forEach((entry) => collectUrlsFromValue(entry, urlSet));
        }
      }

      function buildProcessState(resultData) {
        const BASIC_KEYS_STAGE2 = ["Karşı Ad Soyad", "Karşı Plaka", "Kaza Tarihi", "Kaza Yeri"];
        const STAGE3_KEYS = ["Hasar Onarım Tutarı", "Eksper Rp Tarihi", "Kusur Oranı", "HR Genel Hasar Toplamı"];
        const errorPresent = resultData && (resultData.status === "error" || resultData.error);

        const urlSet = new Set();
        collectUrlsFromValue(resultData, urlSet);
        const allUrls = Array.from(urlSet);
        const fileUrls = allUrls.filter((url) => /\.(pdf|png|jpg|jpeg)(\?|$)/i.test(url));

        const stage2Count = BASIC_KEYS_STAGE2.filter((key) => {
          const value = getValueByKey(resultData, key);
          return value !== undefined && value !== null && String(value).trim() !== "";
        }).length;

        const stage3Ready = STAGE3_KEYS.some((key) => {
          const value = getValueByKey(resultData, key);
          return value !== undefined && value !== null && String(value).trim() !== "";
        });

        const ihtarUrl = getIhtarUrl(resultData);

        if (errorPresent) {
          return { stage: "error" };
        }

        if (ihtarUrl) {
          return { stage: 4, ihtarUrl };
        }

        if (stage3Ready) {
          return { stage: 3 };
        }

        if (stage2Count >= 1) {
          return { stage: 2 };
        }

        if (fileUrls.length > 0) {
          return { stage: 1 };
        }

        return { stage: 0 };
      }

      function setProcessStepState(activeStep, isError) {
        if (!processSteps || !processSteps.length) {
          return;
        }
        processSteps.forEach((step) => {
          const stepNumber = Number(step.dataset.step);
          step.classList.remove("done", "active", "pending", "error");
          if (isError) {
            step.classList.add("error");
            const circle = step.querySelector(".process-circle");
            if (circle) {
              circle.textContent = String(stepNumber);
            }
            return;
          }
          if (stepNumber < activeStep) {
            step.classList.add("done");
          } else if (stepNumber === activeStep) {
            step.classList.add("active");
          } else {
            step.classList.add("pending");
          }
          const circle = step.querySelector(".process-circle");
          if (circle) {
            circle.textContent = stepNumber < activeStep ? "✓" : String(stepNumber);
          }
        });
      }

      function updateProcessUI(resultData) {
        if (!processCard || !processMini || !processCta || !processNote || !processTitle || !processSubtitle || !processTag) {
          return;
        }
        const { stage, ihtarUrl } = buildProcessState(resultData);
        const karsiPlaka = getValueByKey(resultData, "Karşı Plaka");
        const kazaTarihi = getValueByKey(resultData, "Kaza Tarihi");
        const tahminiTutar = getResultAmount(resultData);

        const miniLines = [];
        if (karsiPlaka) {
          miniLines.push(`Karşı Plaka: ${karsiPlaka}`);
        }
        if (kazaTarihi) {
          miniLines.push(`Kaza Tarihi: ${kazaTarihi}`);
        }
        if (tahminiTutar) {
          miniLines.push(`Tahmini Değer Kaybı: ${tahminiTutar}`);
        }

        processMini.innerHTML = "";
        if (miniLines.length > 0) {
          processMini.classList.remove("is-hidden");
          miniLines.slice(0, 2).forEach((line) => {
            const span = document.createElement("span");
            const separatorIndex = line.indexOf(":");
            const label = separatorIndex === -1 ? line : line.slice(0, separatorIndex);
            const value = separatorIndex === -1 ? "" : line.slice(separatorIndex + 1);
            span.innerHTML = `<strong>${label.trim()}:</strong>${value ? ` ${value.trim()}` : ""}`;
            processMini.appendChild(span);
          });
        } else {
          processMini.classList.add("is-hidden");
        }

        processCta.classList.add("is-hidden");
        processNote.classList.add("is-hidden");
        processCta.removeAttribute("href");
        processCta.removeAttribute("download");
        if (petitionDownload) {
          petitionDownload.classList.add("is-hidden");
          petitionDownload.removeAttribute("href");
          petitionDownload.removeAttribute("download");
        }

        const shouldShowProcess = stage !== 0 || hasStartedCalculation || hasResultPayload(currentResultJson);
        setProcessCardVisibility(shouldShowProcess);
        if (shouldShowProcess) {
          moveProcessCardToTop();
        }

        if (stage === "error") {
          processTag.textContent = "Sorun oluştu";
          processTitle.textContent = "Belgeler okunamadı";
          processSubtitle.textContent =
            "Lütfen daha net/okunabilir belge yükleyin. Sorun devam ederse destek ekibimiz yardımcı olur.";
          processNote.classList.add("is-hidden");
          processCard.classList.remove("process-ready");
          setProcessStepState(1, true);
          return;
        }

        if (stage === 4) {
          processTag.textContent = "Tamamlandı";
          processTitle.textContent = "İhtar dilekçeniz hazır";
          processSubtitle.textContent = "İhtar hazır — indirebilirsiniz. Belgeler işlem bitince otomatik silinir.";
          processNote.textContent = "İhtar hazır — indirebilirsiniz. Belgeler işlem bitince otomatik silinir.";
          processNote.classList.remove("is-hidden");
          if (ihtarUrl) {
            processCta.href = ihtarUrl;
            processCta.target = "_blank";
            processCta.removeAttribute("download");
            processCta.classList.remove("is-hidden");
            if (petitionDownload) {
              petitionDownload.href = ihtarUrl;
              petitionDownload.target = "_blank";
              petitionDownload.removeAttribute("download");
              petitionDownload.classList.remove("is-hidden");
            }
            try {
              processCard && processCard.scrollIntoView({ behavior: "smooth", block: "start" });
            } catch (e) {}
          }
          try {
            if ("Notification" in window) {
              if (Notification.permission === "granted") {
                new Notification("İhtar dilekçeniz hazır", { body: "İndirmek için butona tıklayın." });
              } else if (Notification.permission === "default") {
                Notification.requestPermission().then((perm) => {
                  if (perm === "granted") {
                    new Notification("İhtar dilekçeniz hazır", { body: "İndirmek için butona tıklayın." });
                  }
                });
              }
            }
          } catch (e) {}
          setUiState("success");
          if (statusStateLabel) {
            statusStateLabel.textContent = "Hesaplama tamamlandı";
          }
          setProcessStepState(4, false);
          return;
        }

        if (stage === 3) {
          processTag.textContent = "Hazırlanıyor";
          processTitle.textContent = "Değer kaybı tahmini hazırlanıyor";
          processSubtitle.textContent =
            "Bu hesaplama bir tahmindir; nihai tutar tahkim bilirkişisiyle belirlenir.";
          processNote.textContent =
            "Sigorta başvurularında bir sigorta hukuku avukatıyla ilerlemek, hakkınızın eksik kalmamasına yardımcı olabilir.";
          processNote.classList.remove("is-hidden");
          setProcessStepState(3, false);
          return;
        }

        if (stage === 2) {
          processTag.textContent = "İşleniyor";
          processTitle.textContent = "Bilgiler çıkarılıyor";
          processSubtitle.textContent =
            "Evraklardan gerekli alanlar otomatik alınır. Eksik/okunmayan kısım varsa sizden istenir.";
          setProcessStepState(2, false);
          return;
        }

        if (stage === 1) {
          processTag.textContent = "Belgeler alındı";
          processTitle.textContent = "Belgeler alındı";
          processSubtitle.textContent = "Okunabilirlik kontrolü yapılıyor. Belgeleriniz işlem tamamlanınca silinir.";
          setProcessStepState(1, false);
          return;
        }

        if (hasStartedCalculation) {
          processTag.textContent = "İşleniyor";
          processTitle.textContent = "Belgeler işleniyor";
          processSubtitle.textContent = "Veriler geldikçe süreç adımları güncellenecek.";
        } else {
          processTag.textContent = "Bekleniyor";
          processTitle.textContent = "Belgeler bekleniyor";
          processSubtitle.textContent = "Süreç başladığında adım adım bilgilendirileceksiniz.";
        }
        setProcessStepState(1, false);
      }

      let parsedResult = initialPayload.parsed;
      function getResultAmount(resultData) {
        if (!resultData || typeof resultData !== "object") {
          return "";
        }
        if (resultData.amount) {
          return String(resultData.amount);
        }
        const candidateKeys = [
          "Tahmini Değer Kaybı",
          "Tahmini Değer Kaybı Tutarı",
          "Değer Kaybı Tutarı",
          "Deger Kaybi Tutari",
          "Tahmini Deger Kaybi Tutari",
          "DK Tutarı",
          "DK Tutari",
          "Tazminat Tutarı",
        ];
        for (const key of candidateKeys) {
          const value = getValueByKey(resultData, key);
          if (value !== undefined && value !== null && String(value).trim() !== "") {
            return String(value);
          }
        }
        for (const [entryKey, entryValue] of Object.entries(resultData)) {
          if (typeof entryKey === "string" && /değer kaybı|deger kaybi/i.test(entryKey)) {
            if (entryValue !== undefined && entryValue !== null && String(entryValue).trim() !== "") {
              return String(entryValue);
            }
          }
        }
        return "";
      }

      function getResultDate(resultData) {
        if (!resultData || typeof resultData !== "object") {
          return "";
        }
        const dateKeys = ["Hesaplama Tarihi", "Hesaplama tarihi", "İhtar Tarihi", "Tarih", "Date"];
        for (const key of dateKeys) {
          const value = getValueByKey(resultData, key);
          if (value !== undefined && value !== null && String(value).trim() !== "") {
            return String(value);
          }
        }
        return "";
      }

      function hasResultDataValue(resultData) {
        return Boolean(resultData && (getResultAmount(resultData) || resultData.status === "error"));
      }

      function applyResultState(resultData) {
        if (resultData && resultData.status === "error") {
          setUiState("error");
          setOutputVisibility(true);
          return;
        }
        const amountValue = getResultAmount(resultData);
        if (resultData && amountValue) {
          setUiState("success");
          resultAmount.textContent = amountValue;
          const resultDateValue = getResultDate(resultData);
          resultDate.textContent = `Hesaplama tarihi: ${resultDateValue || "GG/AA/YYYY"}`;
          setOutputVisibility(true);
        }
      }

      function updateSummary(resultData) {
        if (!summaryCard || !summaryStatus || !summaryAmount || !summaryDate || !summaryDownload) {
          return;
        }
        const ihtarUrl = getIhtarUrl(resultData);
        const amountValue = getResultAmount(resultData);
        const dateValue = getResultDate(resultData);

        if (amountValue) {
          summaryAmount.textContent = amountValue;
          summaryStatus.textContent =
            "Hesaplama tamamlandı. Tahmini değer kaybı tutarı ve indirilebilir ihtar aşağıda.";
        } else {
          summaryAmount.textContent = "₺ --";
          summaryStatus.textContent =
            "Henüz hesaplama yapılmadı. Evraklar yüklendiyse hesaplamayı başlatabilirsiniz.";
        }

        summaryDate.textContent = `Hesaplama tarihi: ${dateValue || "--"}`;

        if (ihtarUrl) {
          summaryDownload.href = ihtarUrl;
          summaryDownload.classList.remove("is-hidden");
        } else {
          summaryDownload.removeAttribute("href");
          summaryDownload.classList.add("is-hidden");
        }
      }

      function applyEvrakState(isReady, resultPresent) {
        const processActive = hasStartedCalculation || PIN_PROCESS_CARD;
        const hasAnyPayloadLocal = hasResultPayload(currentResultJson) || Boolean(getIhtarUrl(parsedResult));
        const shouldShowSummary = processActive || hasAnyPayloadLocal;
        setSummaryVisibility(shouldShowSummary);

        if (summaryCalculateButton) {
          summaryCalculateButton.disabled = !isReady;
        }

        if (processActive && !hasAnyPayloadLocal) {
          setStageOneHidden(true);
          setPrimaryCtaHidden(false);
          setOutputVisibility(true);
          setProcessVisibility(true);

          setProcessCardVisibility(true);
          moveProcessCardToTop();

          if (actionButton) {
            actionButton.disabled = true;
            actionButton.textContent = "İşleniyor";
          }
          if (statusStateLabel) {
            statusStateLabel.textContent = "İşlem sürüyor";
          }
          return;
        }

        if (hasAnyPayloadLocal) {
          setStageOneHidden(false);
          setPrimaryCtaHidden(true);
          setProcessVisibility(true);
          setOutputVisibility(true);
          setProcessCardVisibility(true);
          return;
        }

        setProcessVisibility(isReady || resultPresent || hasAnyPayloadLocal);
        setProcessCardVisibility(isReady || resultPresent || hasAnyPayloadLocal);
        setSummaryVisibility(shouldShowSummary);

        if (isReady) {
          setCalculateButtonState(true);
          setPrimaryCtaHidden(false);
          if (statusStateLabel) {
            statusStateLabel.textContent = "Hesaplamaya Hazır";
          }
          if (actionButton) {
            actionButton.disabled = false;
            actionButton.textContent = "Hesaplamayı Başlat";
          }
          if (!resultPresent) {
            setUiState("empty");
          }
          setStageOneHidden(false);
          setOutputVisibility(resultPresent);
        } else {
          setCalculateButtonState(false);
          setPrimaryCtaHidden(false);
          if (statusStateLabel) {
            statusStateLabel.textContent = "Belgeler kontrol ediliyor";
          }
          if (actionButton) {
            actionButton.disabled = true;
            actionButton.textContent = "Belgeler Bekleniyor";
          }
          if (!resultPresent) {
            setUiState("empty");
          }
          setStageOneHidden(false);
          setOutputVisibility(resultPresent);
        }
      }

      const hasResultData = hasResultDataValue(parsedResult);
      const hasInitialPayload = hasResultPayload(currentResultJson);

      hasStartedCalculation = readPersistedProcessActive() && hasInitialPayload;
      if (!hasInitialPayload) {
        persistProcessActive(false);
      }
      if (hasStartedCalculation) {
        setProcessCardVisibility(true);
        moveProcessCardToTop();
        setOutputVisibility(true);
      }

      updateProcessUI(parsedResult);
      updateSummary(parsedResult);
      const hasAnyPayload = hasResultPayload(currentResultJson) || Boolean(getIhtarUrl(parsedResult));
      if (hasAnyPayload) {
        setProcessVisibility(true);
        setOutputVisibility(true);
        setProcessCardVisibility(true);
        setPrimaryCtaHidden(true);
      }
      applyEvrakState(evraklarYuklendi, hasResultData);
      applyResultState(parsedResult);

      function toggleModal(isOpen) {
        if (!howItWorksModal) {
          return;
        }
        howItWorksModal.classList.toggle("active", isOpen);
        howItWorksModal.setAttribute("aria-hidden", String(!isOpen));
      }

      function toggleTrustModal(isOpen) {
        if (!trustDetailsModal) {
          return;
        }
        trustDetailsModal.classList.toggle("active", isOpen);
        trustDetailsModal.setAttribute("aria-hidden", String(!isOpen));
      }

      function toggleLawyerReferralModal(isOpen) {
        if (!lawyerReferralModal) {
          return;
        }
        lawyerReferralModal.classList.toggle("active", isOpen);
        lawyerReferralModal.setAttribute("aria-hidden", String(!isOpen));
      }

      function setStageOneHidden(isHidden) {
        if (!stageOne) {
          return;
        }
        if (isHidden && stageOne.contains(document.activeElement)) {
          if (processCard) {
            processCard.focus();
          } else {
            document.body.focus();
          }
        }
        stageOne.classList.toggle("is-hidden", isHidden);
        stageOne.setAttribute("aria-hidden", String(isHidden));
        stageOne.toggleAttribute("inert", isHidden);
      }

      function setPrimaryCtaHidden(isHidden) {
        if (!primaryCta) {
          return;
        }
        primaryCta.classList.toggle("is-hidden", isHidden);
        primaryCta.setAttribute("aria-hidden", String(isHidden));
      }

      function setSummaryVisibility(isVisible) {
        if (!summaryCard) {
          return;
        }
        summaryCard.classList.toggle("is-hidden", !isVisible);
        summaryCard.setAttribute("aria-hidden", String(!isVisible));
      }

      function setOutputVisibility(isVisible) {
        if (resultCard) {
          resultCard.classList.toggle("is-hidden", !isVisible);
        }
        if (petitionCard) {
          petitionCard.classList.toggle("is-hidden", !isVisible);
        }
      }

      function setProcessVisibility(isVisible) {
        if (statusCard) {
          statusCard.classList.toggle("is-hidden", !isVisible);
        }
        if (actionBar) {
          actionBar.classList.toggle("is-hidden", !isVisible);
        }
        if (howItWorksLink) {
          howItWorksLink.classList.toggle("is-hidden", !isVisible);
        }
      }

      if (howItWorksLink) {
        howItWorksLink.addEventListener("click", (event) => {
          event.preventDefault();
          toggleModal(true);
        });
      }

      if (trustDetailsLink) {
        trustDetailsLink.addEventListener("click", (event) => {
          event.preventDefault();
          toggleTrustModal(true);
        });
      }

      if (closeModalButton) {
        closeModalButton.addEventListener("click", () => toggleModal(false));
      }

      if (closeTrustModalButton) {
        closeTrustModalButton.addEventListener("click", () => toggleTrustModal(false));
      }

      if (lawyerReferralButton) {
        lawyerReferralButton.addEventListener("click", () => toggleLawyerReferralModal(true));
      }

      if (closeLawyerReferralModal) {
        closeLawyerReferralModal.addEventListener("click", () => toggleLawyerReferralModal(false));
      }

      if (howItWorksModal) {
        howItWorksModal.addEventListener("click", (event) => {
          if (event.target === howItWorksModal) {
            toggleModal(false);
          }
        });
      }

      if (trustDetailsModal) {
        trustDetailsModal.addEventListener("click", (event) => {
          if (event.target === trustDetailsModal) {
            toggleTrustModal(false);
          }
        });
      }

      if (lawyerReferralModal) {
        lawyerReferralModal.addEventListener("click", (event) => {
          if (event.target === lawyerReferralModal) {
            toggleLawyerReferralModal(false);
          }
        });
      }

      const WATCHER_KEY = "__DK_WATCHER__";
      if (window[WATCHER_KEY] && typeof window[WATCHER_KEY].stop === "function") {
        window[WATCHER_KEY].stop();
      }

      const initialResultPayload = resolveResultPayload(window.RESULT_DATA_JSON || "");
      let lastResultJson = initialResultPayload.raw;
      let lastParsed = initialResultPayload.parsed;
      let lastSig = buildResultSignature(initialResultPayload.raw, initialResultPayload.parsed);
      let lastEvrakState = Boolean(window.EVRAKLAR_YUKLENDI);
      let intervalId = null;

      function tick() {
        const rawValue = window.RESULT_DATA_JSON || "";
        const currentEvrakState = Boolean(window.EVRAKLAR_YUKLENDI);
        const nextPayload = resolveResultPayload(rawValue);
        const nextParsed = nextPayload.parsed;
        const nextSig = buildResultSignature(nextPayload.raw, nextParsed);
        const changed = nextPayload.raw !== lastResultJson || nextSig !== lastSig;

        if (changed) {
          currentResultJson = rawValue;
          lastResultJson = nextPayload.raw;
          lastParsed = nextParsed;
          lastSig = nextSig;

          parsedResult = nextParsed;
          if (hasResultPayload(rawValue) || Boolean(getIhtarUrl(nextParsed))) {
            setProcessVisibility(true);
            setOutputVisibility(true);
            setProcessCardVisibility(true);
            setPrimaryCtaHidden(true);
          }
          updateProcessUI(nextParsed);
          updateSummary(nextParsed);
          applyResultState(nextParsed);
        }

        if (currentEvrakState !== lastEvrakState || changed) {
          lastEvrakState = currentEvrakState;
          evraklarYuklendi = currentEvrakState;
          applyEvrakState(currentEvrakState, hasResultDataValue(parsedResult));
        }
      }

      intervalId = window.setInterval(tick, 700);

      window[WATCHER_KEY] = {
        stop: () => {
          if (intervalId) {
            window.clearInterval(intervalId);
          }
          intervalId = null;
        },
      };
    })();
  </script>
</body>
</html>
