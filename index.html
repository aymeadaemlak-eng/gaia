<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Değer Kaybı SaaS Modülü</title>
  <style>
    :root {
      color-scheme: light;
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
      --bg: #f7f8fb;
      --card: #ffffff;
      --text: #1d2433;
      --muted: #5f6b7a;
      --primary: #1f6feb;
      --primary-dark: #164fc5;
      --border: #e4e8f0;
      --success: #0a7b42;
      --warning: #f59e0b;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    #app {
      min-height: 100vh;
      padding: 20px;
    }

    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
      border: 1px solid var(--border);
    }

    h1, h2, h3 {
      margin: 0 0 12px;
    }

    p {
      margin: 0 0 12px;
      color: var(--muted);
      line-height: 1.5;
    }

    .stack {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .grid {
      display: grid;
      gap: 20px;
    }

    .hero {
      display: grid;
      gap: 16px;
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .badge {
      display: inline-flex;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(31, 111, 235, 0.1);
      color: var(--primary);
      font-weight: 600;
      font-size: 12px;
      letter-spacing: 0.3px;
      text-transform: uppercase;
    }

    .progress {
      display: grid;
      gap: 12px;
    }

    .progress-step {
      display: flex;
      gap: 12px;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fdfdff;
      align-items: center;
    }

    .progress-step span {
      font-weight: 700;
      color: var(--primary);
      background: rgba(31, 111, 235, 0.1);
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    label {
      font-weight: 600;
      font-size: 14px;
    }

    input[type="file"] {
      padding: 16px;
      border: 2px dashed #cfd8e6;
      border-radius: 14px;
      background: #f9fafc;
    }

    button {
      border: none;
      padding: 14px 18px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      background: var(--primary);
      color: #fff;
      transition: background 0.2s ease;
    }

    button:hover {
      background: var(--primary-dark);
    }

    button:disabled {
      background: #9db8f3;
      cursor: not-allowed;
    }

    .note {
      padding: 12px;
      border-radius: 12px;
      background: #f2f6ff;
      color: var(--muted);
      font-size: 14px;
    }

    .info {
      padding: 16px;
      border-radius: 14px;
      border: 1px solid #fde68a;
      background: #fffbeb;
      color: #92400e;
      font-size: 14px;
    }

    .status {
      padding: 12px;
      border-radius: 12px;
      background: #f4f8f3;
      border: 1px solid #c9e7d4;
      color: var(--success);
      font-weight: 600;
      font-size: 14px;
    }

    .list {
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
    }

    .result {
      border: 1px solid #d7e3f8;
      background: #f3f7ff;
      border-radius: 12px;
      padding: 16px;
    }

    .result a {
      display: inline-flex;
      margin-top: 8px;
      color: var(--primary);
      font-weight: 600;
      text-decoration: none;
    }

    .result a:hover {
      text-decoration: underline;
    }

    .meta {
      display: grid;
      gap: 8px;
      font-size: 14px;
      color: var(--muted);
    }

    .meta strong {
      color: var(--text);
    }

    .upload-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .upload-actions button {
      flex: 1;
      min-width: 220px;
    }

    .help-card ul {
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
    }

    @media (min-width: 720px) {
      #app {
        padding: 40px;
        max-width: 1100px;
        margin: 0 auto;
      }

      .grid {
        grid-template-columns: minmax(0, 1.4fr) minmax(260px, 0.9fr);
        align-items: start;
      }

      .hero {
        grid-template-columns: minmax(0, 1fr) minmax(240px, 0.6fr);
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <section class="card hero">
      <div class="stack">
        <span class="badge">Değer Kaybı B2C SaaS</span>
        <h1>Evraklarını yükle, tahmini değer kaybını hemen gör</h1>
        <p>
          Trafik kazası dosyan için gerekli evrakları tek noktadan topla. Sistem, ekspertiz raporunu ve ek belgeleri
          analiz ederek sana özel tahmini tutarı çıkarır ve dilekçeni hazırlar.
        </p>
        <div class="hero-actions">
          <button type="button" id="scrollUpload">Evrak yüklemeye başla</button>
          <div class="meta">
            <div><strong>Ortalama süre:</strong> 3-5 dakika</div>
            <div><strong>Sonuç:</strong> Tahmini tutar + dilekçe</div>
          </div>
        </div>
      </div>
      <div class="progress">
        <div class="progress-step">
          <span>1</span>
          <div>
            <strong>Evrakları yükle</strong>
            <p>Eksper raporu ve ek belgeleri sisteme ekle.</p>
          </div>
        </div>
        <div class="progress-step">
          <span>2</span>
          <div>
            <strong>Otomatik inceleme</strong>
            <p>Sistem raporları doğrular, tamamlanması gerekenleri listeler.</p>
          </div>
        </div>
        <div class="progress-step">
          <span>3</span>
          <div>
            <strong>Sonucu indir</strong>
            <p>Tahmini değer kaybı ve dilekçeyi anında al.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="grid">
      <div class="card stack" id="uploadSection">
        <h2>Evrak yükleme</h2>
        <p class="note">
          Başvurunun tamamlanması için eksper raporu zorunlu. Diğer belgeler sonucu hızlandırır ve tutarı netleştirir.
        </p>
        <div class="stack">
          <div class="input-group">
            <label for="expertReport">Eksper raporu (zorunlu)</label>
            <input id="expertReport" type="file" accept="application/pdf,image/*" required />
            <p class="note">
              Eksper raporunu e-Devlet üzerinden &ldquo;Sigorta Bilgi ve Gözetim Merkezi (SBM)&rdquo; hizmetlerinden
              indirebilirsin. Genellikle e-Devlet &gt; Kurumlar &gt; SBM &gt; Eksper Raporu / Kaza Dosyası
              Sorgulama adımlarından erişilir.
            </p>
          </div>
          <div class="input-group">
            <label for="optionalDocs">Diğer evraklar (opsiyonel)</label>
            <input id="optionalDocs" type="file" accept="application/pdf,image/*" multiple />
            <p class="note">
              Ruhsat (siz ve karşı taraf), kaza tespit tutanağı ve sigorta poliçeleri gibi belgeler yükleyebilirsin.
              Ne kadar çok evrak varsa sonuç o kadar netleşir.
            </p>
          </div>
        </div>
        <div class="upload-actions">
          <button id="uploadButton" type="button">Evrakları yükle ve hesaplamayı başlat</button>
          <span class="meta"><strong>Gizlilik:</strong> Evraklar sadece dosyan için kullanılır.</span>
        </div>
        <div id="statusArea" class="status" hidden>Evraklar hazırlanıyor...</div>
        <div class="result" id="resultArea" hidden>
          <strong>Hazırlanan çıktı</strong>
          <p id="resultAmount"></p>
          <a id="resultLink" href="#" target="_blank" rel="noopener">Dilekçeyi indir</a>
        </div>
        <div class="info" id="waitingNote" hidden>
          <strong>Başvurun hazırlandıktan sonra:</strong>
          <p>
            İşlemler birkaç dakika sürebilir. Bu süreçte başvurun hazırlık aşamasındadır. Değer kaybı konusunda
            sigorta hukuku alanında uzman bir avukatla çalışmak, hak kaybını önlemek açısından önemlidir. Birçok
            uzman avukat, vekâlet ücreti, harç ve bilirkişi giderlerini karşı taraftan tahsil ederek sana ek maliyet
            çıkarmadan süreci yönetebilir.
          </p>
          <p>
            Avukatla başvuru yapacak kullanıcılarımız için süreç daha hızlı ilerler; bireysel kullanıcılar ise
            sonuçlanana kadar sistem üzerinden güncel bildirim alacaktır.
          </p>
        </div>
        <ul class="list" id="fileList"></ul>
      </div>

      <aside class="stack">
        <div class="card help-card stack">
          <h3>Kontrol listesi</h3>
          <ul>
            <li>Eksper raporu (PDF veya fotoğraf).</li>
            <li>Ruhsat fotokopileri (siz + karşı taraf).</li>
            <li>Kaza tespit tutanağı (varsa).</li>
            <li>Sigorta poliçesi ve hasar dosya no.</li>
          </ul>
        </div>
        <div class="card stack">
          <h3>Sık sorulanlar</h3>
          <p><strong>Ne kadar sürede sonuç alırım?</strong> Evraklara göre 3-15 dakika.</p>
          <p><strong>Evraklarım güvende mi?</strong> Veriler yalnızca hesaplama için kullanılır.</p>
          <p><strong>Eksik evrakla başvurabilir miyim?</strong> Evet, ama sonuç netliği azalır.</p>
        </div>
      </aside>
    </section>
  </div>

  <script>
    // Bubble üzerinden JSON girileceği alan (örnek):
    // const RESULT_DATA_JSON = '{"estimatedAmount":"120.000 TL","petitionUrl":"https://example.com/dilekce.pdf"}';
    const RESULT_DATA_JSON = "";

    const resultArea = document.getElementById("resultArea");
    const resultAmount = document.getElementById("resultAmount");
    const resultLink = document.getElementById("resultLink");

    if (RESULT_DATA_JSON) {
      try {
        const parsed = JSON.parse(RESULT_DATA_JSON);
        if (parsed?.estimatedAmount && parsed?.petitionUrl) {
          resultAmount.textContent = `Tahmini sigorta alacağı: ${parsed.estimatedAmount}`;
          resultLink.href = parsed.petitionUrl;
          resultArea.hidden = false;
        }
      } catch (error) {
        console.warn("RESULT_DATA_JSON parse hatası", error);
      }
    }

    const expertInput = document.getElementById("expertReport");
    const optionalInput = document.getElementById("optionalDocs");
    const uploadButton = document.getElementById("uploadButton");
    const statusArea = document.getElementById("statusArea");
    const waitingNote = document.getElementById("waitingNote");
    const fileList = document.getElementById("fileList");
    const scrollUpload = document.getElementById("scrollUpload");

    scrollUpload.addEventListener("click", () => {
      document.getElementById("uploadSection").scrollIntoView({ behavior: "smooth" });
    });

    const toBase64 = (file) => new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });

    const compressIfPossible = async (base64) => {
      if (!("CompressionStream" in window)) {
        return base64;
      }
      const response = await fetch(base64);
      const blob = await response.blob();
      const stream = blob.stream().pipeThrough(new CompressionStream("gzip"));
      const compressed = await new Response(stream).blob();
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(compressed);
      });
    };

    const refreshFileList = (files) => {
      fileList.innerHTML = "";
      files.forEach((file) => {
        const item = document.createElement("li");
        item.textContent = `${file.name} (${Math.round(file.size / 1024)} KB)`;
        fileList.appendChild(item);
      });
    };

    uploadButton.addEventListener("click", async () => {
      const expertFile = expertInput.files?.[0];
      if (!expertFile) {
        alert("Eksper raporu yüklemek zorunludur.");
        return;
      }

      const otherFiles = Array.from(optionalInput.files || []);
      const allFiles = [expertFile, ...otherFiles];

      refreshFileList(allFiles);
      statusArea.hidden = false;
      waitingNote.hidden = false;
      uploadButton.disabled = true;

      try {
        const base64List = [];
        for (const file of allFiles) {
          const base64 = await toBase64(file);
          const compressed = await compressIfPossible(base64);
          base64List.push(compressed);
        }

        window.outputlist1 = base64List;
        window.output1 = "evraklar_hazir";
        window.output2 = new Date().toISOString();
        window.output3 = "";
        window.output4 = "";

        if (typeof window.bubble_fn_evraklar_hazir === "function") {
          window.bubble_fn_evraklar_hazir();
        }

        statusArea.textContent = "Evraklar hazır! Hesaplama süreci başladı.";
      } catch (error) {
        console.error(error);
        statusArea.textContent = "Bir hata oluştu. Lütfen tekrar deneyin.";
      } finally {
        uploadButton.disabled = false;
      }
    });
  </script>
</body>
</html>
